<!DOCTYPE html>
<html>
<head>
    <title>StreamSocial Geographic Partitioner Monitor</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .metric-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .partition-status { display: flex; align-items: center; margin: 5px 0; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .healthy { background-color: #4CAF50; }
        .degraded { background-color: #FF9800; }
        .failed { background-color: #F44336; }
        .chart-container { height: 400px; margin: 20px 0; }
        .refresh-btn { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç StreamSocial Geographic Partitioner Monitor</h1>
            <p>Real-time partition health and geographic distribution</p>
            <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh Data</button>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">Partition Health Status</div>
                <div id="partition-health"></div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">Regional Message Distribution</div>
                <div id="region-distribution"></div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">Partition Health Chart</div>
            <div id="health-chart" class="chart-container"></div>
        </div>
    </div>

    <script>
        function refreshData() {
            loadPartitionHealth();
            loadRegionDistribution();
            loadHealthChart();
        }
        
        function loadPartitionHealth() {
            $.get('/api/partition-health', function(data) {
                let html = '';
                for (let partition in data) {
                    let info = data[partition];
                    let statusClass = info.status === 'healthy' ? 'healthy' : 'degraded';
                    html += `
                        <div class="partition-status">
                            <div class="status-indicator ${statusClass}"></div>
                            <div>
                                <strong>Partition ${partition}</strong> 
                                (Health: ${info.current_health}%, 
                                Latency: ${info.avg_latency.toFixed(1)}ms,
                                Messages: ${info.message_count})
                            </div>
                        </div>
                    `;
                }
                $('#partition-health').html(html);
            });
        }
        
        function loadRegionDistribution() {
            $.get('/api/region-distribution', function(data) {
                let html = '';
                for (let region in data) {
                    html += `<div>${region}: ${data[region].toLocaleString()} messages</div>`;
                }
                $('#region-distribution').html(html);
            });
        }
        
        function loadHealthChart() {
            $.get('/api/partition-chart', function(data) {
                Plotly.newPlot('health-chart', JSON.parse(data));
            });
        }
        
        // Auto-refresh every 5 seconds
        setInterval(refreshData, 5000);
        
        // Initial load
        refreshData();
    </script>
</body>
</html>
