<!DOCTYPE html>
<html>
<head>
    <title>StreamSocial - Content Moderation Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: #ffffff;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: #ffffff;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.85;
            color: #e5e5e5;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 0.85em;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #059669;
            line-height: 1.2;
        }
        
        .metric-unit {
            font-size: 0.5em;
            color: #9ca3af;
            font-weight: 500;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }
        
        .chart-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
        }
        
        .chart-title {
            font-size: 1.25em;
            margin-bottom: 20px;
            color: #1f2937;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        canvas {
            max-height: 300px;
        }
        
        .status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
            margin-right: 8px;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è StreamSocial Content Moderation</h1>
            <p class="subtitle">
                <span class="status"></span>
                Real-time Pipeline Monitoring
            </p>
        </header>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Throughput</div>
                <div class="metric-value">
                    <span id="throughput">0</span>
                    <span class="metric-unit">posts/sec</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">Spam Rate</div>
                <div class="metric-value">
                    <span id="spam-rate">0</span>
                    <span class="metric-unit">%</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">Policy Violations</div>
                <div class="metric-value">
                    <span id="policy-rate">0</span>
                    <span class="metric-unit">%</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-label">P95 Latency</div>
                <div class="metric-value">
                    <span id="latency-p95">0</span>
                    <span class="metric-unit">ms</span>
                </div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">Processing Throughput</div>
                <canvas id="throughputChart"></canvas>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">Moderation Funnel</div>
                <canvas id="funnelChart"></canvas>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">Latency Distribution</div>
                <canvas id="latencyChart"></canvas>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">Content Quality</div>
                <canvas id="qualityChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        // Chart configurations
        const throughputData = {
            labels: [],
            datasets: [{
                label: 'Posts/Second',
                data: [],
                borderColor: '#059669',
                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2
            }]
        };
        
        const throughputChart = new Chart(
            document.getElementById('throughputChart'),
            {
                type: 'line',
                data: throughputData,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'Posts/Second',
                                color: '#6b7280',
                                font: { size: 12, weight: '500' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        }
                    }
                }
            }
        );
        
        const funnelChart = new Chart(
            document.getElementById('funnelChart'),
            {
                type: 'bar',
                data: {
                    labels: ['Received', 'After Spam', 'After Policy', 'Enriched'],
                    datasets: [{
                        label: 'Posts',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(5, 150, 105, 0.85)',
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(34, 197, 94, 0.85)',
                            'rgba(74, 222, 128, 0.85)'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } }
                }
            }
        );
        
        const latencyChart = new Chart(
            document.getElementById('latencyChart'),
            {
                type: 'bar',
                data: {
                    labels: ['P50', 'P95', 'P99'],
                    datasets: [{
                        label: 'Latency (ms)',
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(245, 158, 11, 0.85)',
                            'rgba(239, 68, 68, 0.85)'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'Milliseconds',
                                color: '#6b7280',
                                font: { size: 12, weight: '500' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        }
                    }
                }
            }
        );
        
        const qualityChart = new Chart(
            document.getElementById('qualityChart'),
            {
                type: 'doughnut',
                data: {
                    labels: ['Clean Posts', 'Spam Filtered', 'Policy Violations'],
                    datasets: [{
                        data: [85, 10, 5],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(245, 158, 11, 0.85)',
                            'rgba(239, 68, 68, 0.85)'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            }
        );
        
        // Update metrics
        function updateMetrics() {
            fetch('/api/metrics')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Update metric cards
                    document.getElementById('throughput').textContent = data.throughput;
                    document.getElementById('spam-rate').textContent = data.spam_rate;
                    document.getElementById('policy-rate').textContent = data.policy_violation_rate;
                    document.getElementById('latency-p95').textContent = data.latency_p95_ms;
                    
                    // Update throughput chart
                    const now = new Date().toLocaleTimeString();
                    throughputData.labels.push(now);
                    throughputData.datasets[0].data.push(data.throughput);
                    
                    if (throughputData.labels.length > 30) {
                        throughputData.labels.shift();
                        throughputData.datasets[0].data.shift();
                    }
                    throughputChart.update();
                    
                    // Update funnel chart
                    const counters = data.counters;
                    funnelChart.data.datasets[0].data = [
                        counters.received || 0,
                        counters.after_spam || 0,
                        counters.after_policy || 0,
                        counters.enriched || 0
                    ];
                    funnelChart.update();
                    
                    // Update latency chart
                    const latencyData = [
                        Math.max(0, data.latency_p50_ms || 0),
                        Math.max(0, data.latency_p95_ms || 0),
                        Math.max(0, data.latency_p99_ms || 0)
                    ];
                    latencyChart.data.datasets[0].data = latencyData;
                    latencyChart.update('none'); // 'none' mode for smoother updates
                    
                    // Update quality chart
                    const total = data.total_processed || 1;
                    qualityChart.data.datasets[0].data = [
                        ((total - data.spam_filtered - data.policy_violations) / total * 100),
                        (data.spam_filtered / total * 100),
                        (data.policy_violations / total * 100)
                    ];
                    qualityChart.update();
                })
                .catch(error => {
                    console.error('Error fetching metrics:', error);
                });
        }
        
        // Update every second
        setInterval(updateMetrics, 1000);
        updateMetrics();
    </script>
</body>
</html>
