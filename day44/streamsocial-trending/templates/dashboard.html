<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamSocial - Trending Hashtags</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8f9fa;
            color: #1a202c;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border-left: 4px solid #0d9488;
        }
        
        h1 {
            font-size: 2.25em;
            color: #1a202c;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            color: #64748b;
            font-size: 1em;
            font-weight: 400;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid #e2e8f0;
        }
        
        .card-title {
            font-size: 1.375em;
            margin-bottom: 24px;
            color: #1a202c;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        .trending-list {
            list-style: none;
        }
        
        .trending-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .trending-item:hover {
            background: #f1f5f9;
            border-left-color: #0d9488;
            transform: translateX(4px);
        }
        
        .rank {
            font-size: 1.5em;
            font-weight: 700;
            color: #0d9488;
            min-width: 48px;
            text-align: center;
        }
        
        .hashtag {
            flex: 1;
            font-size: 1.125em;
            font-weight: 500;
            color: #1a202c;
            margin-left: 12px;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.875em;
            color: #64748b;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #0f766e;
            font-size: 1.1em;
        }
        
        .chart-container {
            height: 400px;
            position: relative;
        }
        
        .pulse {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 16px 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid #e2e8f0;
            margin-bottom: 24px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            color: #475569;
            font-size: 0.9em;
        }
        
        .status-item strong {
            color: #1a202c;
            font-weight: 600;
        }
        
        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• StreamSocial Trending</h1>
            <p class="subtitle">Real-time hashtag trending detection with Kafka Streams</p>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <span class="pulse"></span>
                <span>Live Processing</span>
            </div>
            <div class="status-item">
                Last Updated: <strong id="lastUpdate">--</strong>
            </div>
            <div class="status-item">
                Window: <strong>30 min (5 min advance)</strong>
            </div>
        </div>
        
        <div class="grid" style="margin-top: 20px;">
            <div class="card">
                <h2 class="card-title">üèÜ Top Trending Hashtags</h2>
                <ul id="trendingList" class="trending-list"></ul>
            </div>
            
            <div class="card">
                <h2 class="card-title">üìä Trending Score History</h2>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize chart
        const ctx = document.getElementById('trendChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: []
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Trending Score',
                            color: '#64748b',
                            font: {
                                size: 12,
                                weight: 500
                            }
                        },
                        grid: {
                            color: '#e2e8f0'
                        },
                        ticks: {
                            color: '#64748b'
                        }
                    },
                    x: {
                        grid: {
                            color: '#e2e8f0'
                        },
                        ticks: {
                            color: '#64748b'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            color: '#475569',
                            font: {
                                size: 11
                            },
                            padding: 15,
                            usePointStyle: true
                        }
                    }
                }
            }
        });
        
        // Track hashtag colors - professional palette
        const hashtagColors = {};
        const colors = [
            '#0d9488', '#10b981', '#f59e0b', '#ef4444',
            '#8b5cf6', '#06b6d4', '#84cc16', '#f97316'
        ];
        let colorIndex = 0;
        
        function getHashtagColor(hashtag) {
            if (!hashtagColors[hashtag]) {
                hashtagColors[hashtag] = colors[colorIndex % colors.length];
                colorIndex++;
            }
            return hashtagColors[hashtag];
        }
        
        // Update trending list
        async function updateTrending() {
            try {
                const response = await fetch('/api/trending');
                const trending = await response.json();
                
                const list = document.getElementById('trendingList');
                list.innerHTML = trending.map(item => `
                    <li class="trending-item">
                        <span class="rank">#${item.rank}</span>
                        <span class="hashtag">#${item.hashtag}</span>
                        <div class="stats">
                            <div class="stat">
                                <span class="stat-value">${item.mention_count}</span>
                                <span>mentions</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">${item.unique_users}</span>
                                <span>users</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">${item.score.toFixed(2)}</span>
                                <span>score</span>
                            </div>
                        </div>
                    </li>
                `).join('');
                
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error updating trending:', error);
            }
        }
        
        // Update chart
        async function updateChart() {
            try {
                const response = await fetch('/api/history');
                const history = await response.json();
                
                // Group by hashtag
                const byHashtag = {};
                history.forEach(item => {
                    if (!byHashtag[item.hashtag]) {
                        byHashtag[item.hashtag] = [];
                    }
                    byHashtag[item.hashtag].push(item);
                });
                
                // Get top 5 hashtags by latest score
                const topHashtags = Object.entries(byHashtag)
                    .map(([tag, data]) => ({
                        tag,
                        latestScore: data[data.length - 1].score
                    }))
                    .sort((a, b) => b.latestScore - a.latestScore)
                    .slice(0, 5)
                    .map(x => x.tag);
                
                // Update datasets
                chart.data.datasets = topHashtags.map(hashtag => ({
                    label: `#${hashtag}`,
                    data: byHashtag[hashtag].map(d => d.score),
                    borderColor: getHashtagColor(hashtag),
                    backgroundColor: getHashtagColor(hashtag) + '15',
                    tension: 0.4,
                    borderWidth: 2,
                    pointRadius: 3,
                    pointHoverRadius: 5
                }));
                
                // Update labels (use timestamps from first hashtag)
                if (topHashtags.length > 0) {
                    chart.data.labels = byHashtag[topHashtags[0]].map(d => {
                        const time = new Date(d.timestamp);
                        return time.toLocaleTimeString();
                    });
                }
                
                chart.update('none');
            } catch (error) {
                console.error('Error updating chart:', error);
            }
        }
        
        // Update every 2 seconds
        setInterval(() => {
            updateTrending();
            updateChart();
        }, 2000);
        
        // Initial load
        updateTrending();
        updateChart();
    </script>
</body>
</html>
